<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Steem Sniper API Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <style>
        :root {
            --primary: #6d28d9;
            --primary-dark: #5b21b6;
            --secondary: #10b981;
            --background: #111827;
            --surface: #1f2937;
            --text: #f3f4f6;
            --text-muted: #9ca3af;
            --error: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Navigation */
        #mainNav {
            background-color: var(--surface);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #mainNav .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
        }

        #navLinks a {
            color: var(--text);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.3s ease;
        }

        #navLinks a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Buttons */
        .cyberpunk-button {
            background-color: var(--primary);
            color: var(--text);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: background-color 0.3s ease, transform 0.3s ease;
            cursor: pointer;
        }

        .cyberpunk-button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .cyberpunk-button:active {
            transform: translateY(0);
        }

        /* Forms */
        .cyberpunk-input {
            background-color: var(--surface);
            border: 1px solid var(--text-muted);
            color: var(--text);
            padding: 0.5rem;
            border-radius: 0.375rem;
            width: 100%;
            transition: border-color 0.3s ease;
        }

        .cyberpunk-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Cards */
        .neon-border {
            border: 1px solid var(--primary);
            box-shadow: 0 0 10px var(--primary);
            transition: box-shadow 0.3s ease;
        }

        .neon-border:hover {
            box-shadow: 0 0 20px var(--primary);
        }

        /* Toast notifications */
        .toast-success {
            background-color: var(--secondary) !important;
        }

        .toast-error {
            background-color: var(--error) !important;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            #mainNav .container {
                flex-direction: column;
            }

            #navLinks {
                margin-top: 1rem;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        /* Utility classes */
        .text-center {
            text-align: center;
        }

        .font-bold {
            font-weight: 700;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .space-y-4>*+* {
            margin-top: 1rem;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .rounded {
            border-radius: 0.375rem;
        }
    </style>
</head>

<body class="cyberpunk-bg min-h-screen flex flex-col">
    <nav id="mainNav" class="bg-gray-900 p-4 neon-border">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Steem Sniper</h1>
            <div id="navLinks" class="space-x-4">
                <!-- Navigation links will be dynamically inserted here -->
            </div>
        </div>
    </nav>

    <main id="mainContent" class="flex-grow container mx-auto mt-8 p-4">
        <!-- Main content will be dynamically inserted here -->
    </main>

    <footer class="bg-gray-900 p-4 mt-8 text-center neon-border">
        <p>&copy; 2024 Steem Sniper. All rights reserved.</p>
    </footer>

    <script>
        // Utility functions
        const API_URL = 'http://127.0.0.1:5000';
        const $ = document.querySelector.bind(document);

        const api = {
            async request(method, endpoint, data = null) {
                try {
                    const config = {
                        method,
                        url: `${API_URL}${endpoint}`,
                        headers: { 'Content-Type': 'application/json' }
                    };
                    if (data) config.data = data;
                    const response = await axios(config);
                    return response.data;
                } catch (error) {
                    throw error.response ? error.response.data : error;
                }
            },
            get: (endpoint) => api.request('GET', endpoint),
            post: (endpoint, data) => api.request('POST', endpoint, data),
            put: (endpoint, data) => api.request('PUT', endpoint, data),
            delete: (endpoint) => api.request('DELETE', endpoint)
        };

        function showLoading(element) {
            element.disabled = true;
            element.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Loading...';
        }

        function hideLoading(element, originalContent) {
            element.disabled = false;
            element.innerHTML = originalContent;
        }

        // Navigation and routing
        const routes = {
            home: { title: 'Home', render: renderHome },
            login: { title: 'Login', render: renderLogin },
            register: { title: 'Register', render: renderRegister },
            dashboard: { title: 'Dashboard', render: renderDashboard },
            authors: { title: 'Manage Authors', render: renderAuthors }
        };

        function updateNavigation() {
            const navLinks = $('#navLinks');
            navLinks.innerHTML = '';
            const isLoggedIn = !!localStorage.getItem('username');

            if (isLoggedIn) {
                ['dashboard', 'authors'].forEach(route => {
                    navLinks.innerHTML += `<a href="#" class="cyberpunk-button px-3 py-1 rounded" onclick="navigate('${route}')">${routes[route].title}</a>`;
                });
                navLinks.innerHTML += `<a href="#" class="cyberpunk-button px-3 py-1 rounded" onclick="logout()">Logout</a>`;
            } else {
                ['home', 'login', 'register'].forEach(route => {
                    navLinks.innerHTML += `<a href="#" class="cyberpunk-button px-3 py-1 rounded" onclick="navigate('${route}')">${routes[route].title}</a>`;
                });
            }
        }

        function navigate(route) {
            if (routes[route]) {
                routes[route].render();
                updateNavigation();
            }
        }

        function logout() {
            localStorage.removeItem('username');
            toastr.success('Logged out successfully');
            navigate('home');
        }

        // Page renderers
        function renderHome() {
            $('#mainContent').innerHTML = `
            <div class="text-center">
                <h2 class="text-4xl font-bold mb-4">Welcome to Steem Sniper</h2>
                <p class="mb-4">Optimize your Steem voting strategy with our advanced tools.</p>
                <button onclick="navigate('register')" class="cyberpunk-button px-6 py-2 rounded text-lg">Get Started</button>
            </div>
        `;
        }

        function renderLogin() {
            $('#mainContent').innerHTML = `
            <div class="max-w-md mx-auto">
                <h2 class="text-2xl font-bold mb-4">Login</h2>
                <form id="loginForm" class="space-y-4">
                    <input type="text" id="loginUsername" placeholder="Username" class="w-full p-2 rounded cyberpunk-input" required>
                    <input type="password" id="loginPassword" placeholder="Password" class="w-full p-2 rounded cyberpunk-input" required>
                    <button type="submit" class="w-full p-2 rounded cyberpunk-button">
                        <i class="fas fa-sign-in-alt mr-2"></i>Login
                    </button>
                </form>
            </div>
        `;
            $('#loginForm').addEventListener('submit', handleLogin);
        }

        async function handleLogin(e) {
            e.preventDefault();
            const username = $('#loginUsername').value;
            const password = $('#loginPassword').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalContent = submitBtn.innerHTML;

            try {
                showLoading(submitBtn);
                await api.post('/login', { username, password });
                localStorage.setItem('username', username);
                toastr.success('Logged in successfully');
                navigate('dashboard');
            } catch (error) {
                toastr.error(error.error || 'Login failed');
            } finally {
                hideLoading(submitBtn, originalContent);
            }
        }

        function renderRegister() {
            $('#mainContent').innerHTML = `
            <div class="max-w-md mx-auto">
                <h2 class="text-2xl font-bold mb-4">Register</h2>
                <form id="registerForm" class="space-y-4">
                    <input type="text" id="regUsername" name="username" placeholder="Username" class="w-full p-2 rounded cyberpunk-input" required>
                    <input type="password" id="regPassword" name="password" placeholder="Password" class="w-full p-2 rounded cyberpunk-input" required>
                    <input type="text" id="regPostingKey" name="posting_key" placeholder="Posting Key" class="w-full p-2 rounded cyberpunk-input" required>
                    <input type="text" id="regVoter" name="voter" placeholder="Voter" class="w-full p-2 rounded cyberpunk-input" required>
                    <input type="number" id="regInterval" name="interval" placeholder="Interval" class="w-full p-2 rounded cyberpunk-input" required>
                    <button type="submit" class="w-full p-2 rounded cyberpunk-button">
                        <i class="fas fa-user-plus mr-2"></i>Register
                    </button>
                </form>
            </div>
        `;
            $('#registerForm').addEventListener('submit', handleRegister);
        }

        async function handleRegister(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalContent = submitBtn.innerHTML;
            console.log(data);
            try {
                showLoading(submitBtn);
                await api.post('/register', data);
                toastr.success('Registration successful');
                navigate('login');
            } catch (error) {
                toastr.error(error.error || 'Registration failed');
            } finally {
                hideLoading(submitBtn, originalContent);
            }
        }

        function renderDashboard() {
            const username = localStorage.getItem('username');
            $('#mainContent').innerHTML = `
            <div>
                <h2 class="text-2xl font-bold mb-4">Welcome, ${username}!</h2>
                <p class="mb-4">Here's your Steem Sniper dashboard. Manage your voting strategy and monitor your performance.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-800 p-4 rounded neon-border">
                        <h3 class="text-xl font-semibold mb-2">Quick Stats</h3>
                        <p>Total Votes: 150</p>
                        <p>Successful Snipes: 75</p>
                        <p>Efficiency: 50%</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded neon-border">
                        <h3 class="text-xl font-semibold mb-2">Recent Activity</h3>
                        <ul>
                            <li>Voted on @user1's post</li>
                            <li>Configured new author @user2</li>
                            <li>Updated voting interval</li>
                        </ul>
                    </div>
                </div>
            </div>
        `;
        }

        function renderAuthors() {
            $('#mainContent').innerHTML = `
            <div>
                <h2 class="text-2xl font-bold mb-4">Manage Authors</h2>
                <button id="addAuthorBtn" class="cyberpunk-button px-4 py-2 rounded mb-4">
                    <i class="fas fa-plus mr-2"></i>Add New Author
                </button>
                <div id="authorsList" class="space-y-4"></div>
                <div id="bulkActions" class="mt-4">
                    <h3 class="text-xl font-semibold mb-2">Bulk Actions</h3>
                    <button id="bulkEditBtn" class="cyberpunk-button px-4 py-2 rounded mr-2">
                        <i class="fas fa-edit mr-2"></i>Edit Selected
                    </button>
                    <button id="bulkDeleteBtn" class="cyberpunk-button bg-red-500 px-4 py-2 rounded">
                        <i class="fas fa-trash-alt mr-2"></i>Delete Selected
                    </button>
                </div>
            </div>
        `;
            $('#addAuthorBtn').addEventListener('click', showAddAuthorForm);
            $('#bulkEditBtn').addEventListener('click', bulkEditAuthors);
            $('#bulkDeleteBtn').addEventListener('click', bulkDeleteAuthors);
            loadAuthors();
        }

        async function loadAuthors() {
            const authorsList = $('#authorsList');
            authorsList.innerHTML = '<p>Loading authors...</p>';
            try {
                const authors = await api.get(`/get_authors/${localStorage.getItem('username')}`);
                if (authors.length === 0) {
                    authorsList.innerHTML = '<p>No authors configured yet.</p>';
                    return;
                }
                authorsList.innerHTML = authors.map(author => `
                <div class="bg-gray-800 p-4 rounded neon-border flex justify-between items-center">
                    <div>
                        <input type="checkbox" class="author-checkbox mr-2" data-author-name="${author.name}">
                        <span>${author.name}</span> - Vote: ${author.vote_percentage}%, Delay: ${author.post_delay_minutes}min
                    </div>
                    <div>
                        <button onclick="editAuthor('${author.name}')" class="cyberpunk-button px-2 py-1 rounded mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteAuthor('${author.name}')" class="cyberpunk-button bg-red-500 px-2 py-1 rounded">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            } catch (error) {
                toastr.error('Failed to load authors');
            }
        }

        function showAddAuthorForm() {
            $('#mainContent').innerHTML = `
            <div class="max-w-md mx-auto">
                <h2 class="text-2xl font-bold mb-4">Add New Author</h2>
                <form id="addAuthorForm" class="space-y-4">
                    <input type="text" id="authorName" placeholder="Author Name" class="w-full p-2 rounded cyberpunk-input" required>
                    <input type="number" id="votePercentage" placeholder="Vote Percentage" class="w-full p-2 rounded cyberpunk-input" required>
                    <input type="number" id="postDelayMinutes" placeholder="Post Delay Minutes" class="w-full p-2 rounded cyberpunk-input" required>
                    <input type="number" id="dailyVoteLimit" placeholder="Daily Vote Limit" class="w-full p-2 rounded cyberpunk-input" required>
                    <div class="flex items-center mb-4">
                        <input type="checkbox" id="addComment" class="mr-2 cyberpunk-input">
                        <label for="addComment">Add Comment</label>
                    </div>
                    <div class="flex items-center mb-4">
                        <input type="checkbox" id="addImage" class="mr-2 cyberpunk-input">
                        <label for="addImage">Add Image</label>
                    </div>
                    <input type="text" id="commentText" placeholder="Comment Text" class="w-full p-2 rounded cyberpunk-input">
                    <input type="text" id="imagePath" placeholder="Image Path" class="w-full p-2 rounded cyberpunk-input">
                    <button type="submit" class="w-full p-2 rounded cyberpunk-button">
                        <i class="fas fa-plus mr-2"></i>Add Author
                    </button>
                </form>
            </div>
        `;
            $('#addAuthorForm').addEventListener('submit', handleAddAuthor);
        }

        async function handleAddAuthor(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            data.username = localStorage.getItem('username');
            data.add_comment = $('#addComment').checked;
            data.add_image = $('#addImage').checked;
            data.comment_text = $('#commentText').value;
            data.image_path = $('#imagePath').value;
            data.vote_percentage = $('#votePercentage').value;
            data.post_delay_minutes = $('#postDelayMinutes').value;
            data.daily_vote_limit = $('#dailyVoteLimit').value;
            data.author_name = $('#authorName').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalContent = submitBtn.innerHTML;
            console.log(data);
            try {
                showLoading(submitBtn);
                await api.post('/configure_author', data);
                toastr.success('Author added successfully');
                navigate('authors');
            } catch (error) {
                toastr.error(error.error || 'Failed to add author');
            } finally {
                hideLoading(submitBtn, originalContent);
            }
        }

        async function editAuthor(authorName) {
            try {
                const author = await api.get(`/get_author/${localStorage.getItem('username')}/${authorName}`);
                $('#mainContent').innerHTML = `
                <div class="max-w-md mx-auto">
                    <h2 class="text-2xl font-bold mb-4">Edit Author: ${authorName}</h2>
                    <form id="editAuthorForm" class="space-y-4">
                        <input type="hidden" id="editAuthorName" value="${authorName}">
                        <input type="number" id="editVotePercentage" placeholder="Vote Percentage" value="${author.vote_percentage}" class="w-full p-2 rounded cyberpunk-input" required>
                        <input type="number" id="editPostDelayMinutes" placeholder="Post Delay Minutes" value="${author.post_delay_minutes}" class="w-full p-2 rounded cyberpunk-input" required>
                        <input type="number" id="editDailyVoteLimit" placeholder="Daily Vote Limit" value="${author.daily_vote_limit}" class="w-full p-2 rounded cyberpunk-input" required>
                        <div class="flex items-center mb-4">
                            <input type="checkbox" id="editAddComment" class="mr-2 cyberpunk-input" ${author.add_comment ? 'checked' : ''}>
                            <label for="editAddComment">Add Comment</label>
                        </div>
                        <div class="flex items-center mb-4">
                            <input type="checkbox" id="editAddImage" class="mr-2 cyberpunk-input" ${author.add_image ? 'checked' : ''}>
                            <label for="editAddImage">Add Image</label>
                        </div>
                        <input type="text" id="editCommentText" placeholder="Comment Text" value="${author.comment_text || ''}" class="w-full p-2 rounded cyberpunk-input">
                        <input type="text" id="editImagePath" placeholder="Image Path" value="${author.image_path || ''}" class="w-full p-2 rounded cyberpunk-input">
                        <button type="submit" class="w-full p-2 rounded cyberpunk-button">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                    </form>
                </div>
            `;
                $('#editAuthorForm').addEventListener('submit', handleEditAuthor);
            } catch (error) {
                toastr.error('Failed to load author details');
            }
        }

        async function handleEditAuthor(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            data.username = localStorage.getItem('username');
            data.author_name = $('#editAuthorName').value;
            data.add_comment = $('#editAddComment').checked;
            data.add_image = $('#editAddImage').checked;
            data.comment_text = $('#editCommentText').value;
            data.image_path = $('#editImagePath').value;
            data.vote_percentage = $('#editVotePercentage').value;
            data.post_delay_minutes = $('#editPostDelayMinutes').value;
            data.daily_vote_limit = $('#editDailyVoteLimit').value;

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalContent = submitBtn.innerHTML;

            try {
                showLoading(submitBtn);
                await api.put('/update_author', data);
                toastr.success('Author updated successfully');
                navigate('authors');
            } catch (error) {
                toastr.error(error.error || 'Failed to update author');
            } finally {
                hideLoading(submitBtn, originalContent);
            }
        }

        async function deleteAuthor(authorName) {
            if (confirm(`Are you sure you want to delete ${authorName}?`)) {
                try {
                    await api.post('/delete_author', {
                        username: localStorage.getItem('username'),
                        author_name: authorName
                    });
                    toastr.success('Author deleted successfully');
                    loadAuthors();
                } catch (error) {
                    toastr.error(error.error || 'Failed to delete author');
                }
            }
        }
        let selectedAuthors;
        function bulkEditAuthors() {
            selectedAuthors = getSelectedAuthors();
            console.log(selectedAuthors);
            if (selectedAuthors.length === 0) {
                toastr.warning('No authors selected');
                return;
            }
            $('#mainContent').innerHTML = `
            <div class="max-w-md mx-auto">
                <h2 class="text-2xl font-bold mb-4">Bulk Edit Authors</h2>
                <p class="mb-4">Editing ${selectedAuthors.length} authors</p>
                <form id="bulkEditForm" class="space-y-4">
                    <input type="number" id="bulkVotePercentage" placeholder="Vote Percentage" class="w-full p-2 rounded cyberpunk-input">
                    <input type="number" id="bulkPostDelayMinutes" placeholder="Post Delay Minutes" class="w-full p-2 rounded cyberpunk-input">
                    <input type="number" id="bulkDailyVoteLimit" placeholder="Daily Vote Limit" class="w-full p-2 rounded cyberpunk-input">
                    <button type="submit" class="w-full p-2 rounded cyberpunk-button">
                        <i class="fas fa-save mr-2"></i>Apply Changes
                    </button>
                </form>
            </div>
        `;
            $('#bulkEditForm').addEventListener('submit', handleBulkEdit);
        }

        async function handleBulkEdit(e) {
            e.preventDefault();
            console.log(selectedAuthors);
            const data = {
                username: localStorage.getItem('username'),
                authors: selectedAuthors,
                vote_percentage: $('#bulkVotePercentage').value || null,
                post_delay_minutes: $('#bulkPostDelayMinutes').value || null,
                daily_vote_limit: $('#bulkDailyVoteLimit').value || null
            };
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalContent = submitBtn.innerHTML;

            try {
                showLoading(submitBtn);
                await api.put('/bulk_update_authors', data);
                toastr.success('Authors updated successfully');
                navigate('authors');
            } catch (error) {
                toastr.error(error.error || 'Failed to update authors');
            } finally {
                hideLoading(submitBtn, originalContent);
            }
        }

        async function bulkDeleteAuthors() {
            selectedAuthors = getSelectedAuthors();
            if (selectedAuthors.length === 0) {
                toastr.warning('No authors selected');
                return;
            }
            if (confirm(`Are you sure you want to delete ${selectedAuthors.length} authors?`)) {
                try {
                    await api.post('/bulk_delete_authors', {
                        username: localStorage.getItem('username'),
                        authors: selectedAuthors
                    });
                    toastr.success('Authors deleted successfully');
                    loadAuthors();
                } catch (error) {
                    toastr.error(error.error || 'Failed to delete authors');
                }
            }
        }

        function getSelectedAuthors() {
            console.log(Array.from(document.querySelectorAll('.author-checkbox:checked')));
            //<div>
            //     <input type="checkbox" class="author-checkbox mr-2" data-author-name="${author.name}">
            //           <span>${author.name}</span> - Vote: ${author.vote_percentage}%, Delay: ${author.post_delay_minutes}min
            //     </div>

            return Array.from(document.querySelectorAll('.author-checkbox:checked')).map(checkbox => checkbox.dataset.authorName);
        }


        // Initialize the app
        async function init() {
            updateNavigation();
            navigate('home');
            const allDB = await api.get('/get_all').then((res) => {
                console.log(res);
            });
        }

        // Toastr configuration
        toastr.options = {
            closeButton: true,
            progressBar: true,
            positionClass: "toast-top-right",
            timeOut: 3000
        };

        // Start the app
        init();
    </script>
</body>

</html>